"use client";
import { ChangeEvent, useState } from "react";
import Image from "next/image";

import Button from "../Button";
import Herobox from "../Herobox";
import InputField from "../Inputs";
import { spookyToast } from "../SpookyToast";

import OrangeBackground from "../../../../public/images/orangeBackground.png";
import CloudBottom from "../../../../public/images/cloudBottomLeft.png";
import SignMark from "../../../../public/images/signMark.svg";

const ContactForm = () => {
  const [formData, setFormData] = useState({
    name: "",
    emailAddress: "",
    message: "",
  });
  const [loading, setLoading] = useState(false);


  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // Basic client-side validation
    if (!formData.name.trim() || !formData.emailAddress.trim() || !formData.message.trim()) {
      spookyToast.error("The ghostly spirits demand all fields be filled! ðŸ‘»");
      return;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(formData.emailAddress)) {
      spookyToast.error("That email looks cursed! Check your magical address! ðŸ“§âœ¨");
      return;
    }

    setLoading(true);

    try {
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      });

      const data = await response.json();

      if (response.ok) {
        spookyToast.success("Your message has been sent through the ether! We'll respond soon! ðŸ‘»ðŸ“¬");
        // Reset form
        setFormData({
          name: "",
          emailAddress: "",
          message: "",
        });
      } else {
        spookyToast.error(`ðŸ’€ Spell Failed: ${data.error || 'Something went wrong'}`);
      }
    } catch {
      spookyToast.error("ðŸ’€ The spirits are restless! Please try again later.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <Herobox>
      <div className="relative grid grid-cols-1 lg:grid-cols-[1fr_1.1fr] gap-4 mt-8 z-10 pb-20 lg:pb-0">
        <div>
          <div className="font-(family-name:--trickOrDead) font-normal space-y-3">
            <p className="text-3xl md:text-6xl">Letâ€™s Chat,</p>
            <h1 className="text-5xl md:text-7xl">Reach Out to Us.</h1>
          </div>
          <div className="space-y-8 pt-6 max-w-[55ch]">
            <p>
              Got questions that go bump in the night? Whether you&apos;re haunted by a curious mind, need help with an order, or want to whisper a ghostly suggestion, weâ€™re here to help! At
              Scaremoor, we love hearing from brave soulsâ€”parents, teachers, and little readers alike.
            </p>
            <p>Don&apos;t worryâ€”we only bite in our stories. ðŸ‘»</p>
          </div>
        </div>
        <form onSubmit={handleSubmit} className="shrink-0 max-w-[600px] md:max-w-full">
          <div className="grid grid-cols-1 gap-y-8 w-full">
            <InputField
              labelText="Name"
              inputType="text"
              value={formData.name}
              onChange={(value: string) => setFormData({ ...formData, name: value })}
              isLabel={true}
              backgroungType="dark"
              name="name"
            />
            <InputField
              labelText="Email Address"
              inputType="email"
              value={formData.emailAddress}
              onChange={(value: string) => setFormData({ ...formData, emailAddress: value })}
              isLabel={true}
              backgroungType="dark"
              name="email"
            />
          </div>
          <div className="relative mt-14 text-white">
            <label className="block  mb-2">
              Message <span className="text-red-500">*</span>
            </label>

            <div className="relative ">
              <textarea
                name="message"
                className="w-full h-40 px-4 py-3  bg-transparent border-0 rounded-lg focus:outline-none focus:ring-0 relative z-10"
                aria-label="Message"
                value={formData.message}
                placeholder="Enter your message"
                autoComplete="off"
                onChange={(value: ChangeEvent<HTMLTextAreaElement>) => setFormData({ ...formData, message: value.target.value })}></textarea>

              <svg className="absolute inset-0 w-full h-full -z-10" viewBox="0 0 830 260" preserveAspectRatio="none" aria-hidden="true">
                <path
                  d="M829.588 57.4312C829.318 57.1712 829.098 56.3113 828.908 55.1615V41.9935C829.268 43.4433 829.658 43.1134 829.998 40.4438L829.748 33.4648C829.578 31.0852 829.288 28.7056 828.558 26.4259C828.378 25.856 828.228 25.2861 828.028 24.7262L827.338 23.0764L826.998 22.2566L826.578 21.4667L825.728 19.9069C824.458 17.8972 823.048 15.9675 821.338 14.3178C821.688 14.7077 822.078 15.0577 822.398 15.4776C822.728 15.8975 823.048 16.3175 823.378 16.7274C824.068 17.5373 824.558 18.4772 825.128 19.337C825.678 20.1969 826.048 21.1167 826.468 21.9366C826.868 22.7665 827.088 23.5964 827.348 24.2963C827.388 24.4062 827.418 24.5162 827.458 24.6262C824.668 16.3875 818.118 9.78849 809.758 6.70897C809.258 6.489 808.748 6.25904 808.228 6.03907C807.278 5.69912 806.258 5.41916 805.228 5.11921C804.168 4.93924 803.078 4.73927 801.958 4.63929C800.838 4.61929 799.688 4.5593 798.538 4.63929C797.888 4.68928 797.228 4.74927 796.558 4.81926H774.428C777.478 4.62929 780.488 4.41932 783.188 4.26934C748.548 5.55914 746.848 1.67974 720.428 4.59929L727.758 4.81926H703.348C706.518 4.16936 712.158 3.62944 718.048 3.27949L699.578 4.15936L691.358 2.52961C677.958 3.29949 668.178 3.15951 655.188 2.96954L657.098 2.85956C640.998 0.979849 626.268 3.92939 607.898 3.10952C609.838 2.99954 608.468 2.83956 612.308 2.6196L596.788 2.80957L596.068 2.38963C596.988 3.49946 580.948 3.95939 574.038 4.81926H317.648C323.568 4.76927 330.178 4.78926 340.568 4.18935L339.248 4.02938C348.598 2.78957 370.228 3.64944 382.488 3.41947C377.498 4.16936 363.918 4.24934 354.948 4.5293C368.718 5.13921 403.528 4.5493 415.398 2.92955C423.248 3.17951 440.248 3.83941 428.778 4.49931C456.738 4.76927 440.438 2.18966 464.568 2.67959L463.618 3.9094C490.048 5.66913 515.678 2.32964 540.718 3.9194L542.268 2.42963C547.648 3.05953 558.748 3.34948 560.838 3.92939L548.028 4.43932C558.748 5.69912 560.658 3.2495 573.848 4.12936C573.738 3.67943 562.838 2.65959 562.838 2.15967C509.238 3.01953 456.138 0.879864 401.928 2.38963C403.968 2.5696 406.408 2.77957 405.028 3.06953C399.118 2.70958 388.218 3.09952 389.918 2.29965L391.848 2.18966C377.708 2.52961 364.878 0.699892 356.438 0.719889C350.908 1.73973 327.168 0.289955 333.488 2.03969L324.148 0.939855C321.048 1.57976 322.598 2.42963 316.838 2.75957C307.088 2.6196 306.898 1.9297 314.538 1.48977C277.428 0.819874 233.398 0.999846 195.298 1.54976L205.478 0.729888C196.308 0.319951 172.168 2.16967 180.018 0.0899861C161.448 0.919858 129.298 -0.499923 127.978 1.66974C115.698 -0.429934 82.9984 0.749884 57.1684 1.05984C59.3584 1.98969 54.0484 2.10967 47.3284 2.11967H36.9484C36.1184 2.12967 35.3184 2.13967 34.5584 2.14967C33.7284 2.20966 32.9384 2.26965 32.1984 2.31964C31.4584 2.35964 30.7884 2.47962 30.1784 2.6196C29.5784 2.74958 29.0384 2.86956 28.5884 2.98954C27.5584 2.78957 28.4584 2.36963 30.4884 1.84971C30.9884 1.69974 31.5684 1.60975 32.2084 1.53976C32.8484 1.46977 33.5384 1.38979 34.2684 1.2998C35.6484 1.17982 37.0384 1.11983 38.5384 1.03984C44.4484 0.729887 50.8584 0.479926 51.0584 0C47.7284 0.279957 44.0784 0.459929 40.2184 0.579911C38.2784 0.629903 36.2784 0.669897 34.2484 0.719889C33.0984 0.799877 31.9284 0.819874 30.7684 0.949854C29.6084 1.13982 28.4284 1.25981 27.2784 1.51977C22.6284 2.50961 18.0884 4.46931 14.1684 7.24888C10.2384 10.0185 6.9284 13.5979 4.5784 17.5773C2.1884 21.5867 0.818402 25.956 0.368402 30.1354C0.298402 31.1852 0.248402 32.215 0.198402 33.2249C0.168402 34.1947 0.198402 34.9946 0.198402 35.8645C0.218402 37.5642 0.248402 39.194 0.298402 40.7337C0.498402 46.9228 0.968402 51.802 1.9184 54.5316C1.7684 57.6111 1.6184 57.6511 1.4684 56.5913C1.4684 61.5305 0.808402 68.0795 0.638402 72.9588C1.2984 75.8983 1.6084 65.21 1.8584 77.0281C1.7084 86.4167 0.658402 81.0775 0.168402 84.9469C1.0284 102.854 1.3984 131.27 2.9284 134.349C2.5084 139.668 1.6384 145.258 1.3484 139.359C2.5084 166.874 1.2184 166.784 1.8184 192.64C1.5084 186.361 0.338402 188.831 0.908402 175.973C-0.181598 181.662 -0.081598 192.7 0.148402 205.168C0.258402 211.407 0.408402 217.996 0.458402 224.465V225.075L0.498402 225.765L0.578402 227.145C0.608402 227.605 0.618402 228.065 0.668402 228.515L0.878402 229.875C1.0984 231.684 1.6084 233.434 2.0984 235.154C3.1684 238.573 4.8484 241.683 6.7084 244.442C7.3684 245.082 7.9584 245.762 8.6684 246.332L10.7584 248.042L12.9884 249.552C13.7284 250.051 14.5484 250.431 15.3084 250.861C16.0984 251.451 16.9384 251.881 17.6884 252.331C18.0684 252.551 18.4384 252.761 18.7884 252.971C19.1584 253.151 19.5184 253.321 19.8584 253.481C20.5484 253.811 21.1884 254.111 21.7784 254.401C22.3884 254.641 22.9384 254.861 23.4484 255.051C23.9484 255.251 24.3984 255.441 24.7984 255.601C25.2084 255.741 25.5684 255.861 25.8684 255.971C26.4784 256.201 26.8684 256.381 27.0584 256.51C27.4284 256.78 26.9684 256.87 25.6784 256.74C25.3584 256.71 24.9784 256.66 24.5584 256.6C24.1384 256.53 23.6784 256.391 23.1684 256.261C22.6584 256.121 22.0984 255.961 21.4884 255.781C20.8784 255.611 20.2584 255.311 19.5784 255.051C21.1384 255.901 22.7884 256.451 24.3684 257.04C25.9984 257.48 27.5784 257.97 29.1784 258.18C29.9684 258.29 30.7484 258.48 31.5284 258.51C32.3084 258.56 33.0784 258.61 33.8384 258.66C34.6484 258.72 35.2284 258.7 35.8784 258.72C36.5184 258.72 37.1484 258.73 37.7684 258.74C42.7484 258.78 47.2784 258.75 51.6284 258.7C60.3284 258.6 68.2984 258.39 77.7084 258.39C78.6084 258.52 78.2084 258.72 76.3784 258.75L102.018 258.79C104.748 258.46 114.538 257.78 112.538 256.93C109.168 257.7 103.498 258.16 88.7084 257.65C84.3784 255.871 104.368 257.58 103.228 255.871C95.0984 256.25 89.0084 256.53 85.2584 255.611C91.9284 254.641 102.058 255.711 105.288 254.241L93.0984 254.811C89.7084 254.491 89.8184 254.091 90.4284 253.751H129.828C118.048 254.281 117.168 255.751 113.238 256.78L145.508 256.55C145.208 257.66 125.198 257.5 119.148 257.78C109.538 259.11 136.498 258.73 132.988 259.78C137.648 258.9 150.388 259.19 158.508 258.81L159.948 259.4C174.988 260.02 183.428 258.52 197.018 258.55C198.228 258.72 198.418 258.84 198.188 258.95C202.958 258.28 207.818 257.46 216.128 257.22L209.798 257.29C220.568 255.971 246.068 255.101 234.618 253.751H254.698L264.028 253.881C260.368 255.441 253.788 257.82 234.878 257.99L232.668 258.65C246.838 259.53 272.658 257.44 263.408 256.111C277.668 252.361 313.568 255.981 337.638 254.411C339.338 255.431 326.018 255.841 320.178 256.55C312.948 256.67 307.758 256.69 307.178 255.831C276.158 256.4 313.488 259.06 278.728 258.7C261.648 258.18 299.628 257.06 274.398 256.92L256.398 259.75C272.038 259.68 286.168 259.21 298.738 258.87C368.578 257 417.948 258.59 417.948 258.59L725.778 257.66C757.968 257.26 769.558 257.38 782.318 254.581C777.038 254.131 763.548 254.191 761.538 253.761H799.098C815.548 253.761 828.888 240.903 828.888 225.045V144.958C828.918 143.978 828.948 142.978 828.968 141.928L828.888 141.758V132.09C828.928 131.7 828.968 131.23 828.998 130.66C828.958 130.95 828.918 131.17 828.888 131.33V68.2895C828.958 69.6093 828.928 71.729 828.888 73.8286L829.568 57.4312H829.588ZM679.998 3.9094C687.238 4.07937 693.218 4.44931 696.968 4.84925H648.198C649.468 4.82926 651.048 4.79926 653.038 4.75927C643.488 2.96954 672.548 5.03922 680.008 3.9094H679.998ZM640.378 3.60944C647.758 4.24934 642.668 4.71927 643.608 4.84925H618.408C623.938 4.13936 627.458 3.31949 640.378 3.60944ZM610.698 4.84925H601.418C601.958 4.75927 602.508 4.66928 603.088 4.57929C608.268 4.5193 610.078 4.64928 610.688 4.84925H610.698ZM595.988 4.75927C595.788 4.78926 595.608 4.81926 595.418 4.84925H585.238C587.248 4.48931 588.398 4.04938 595.988 4.75927ZM300.168 3.50946L318.928 3.36948C314.358 4.42932 305.888 4.40932 301.318 4.85925H287.238C293.888 3.8894 288.268 2.28965 303.578 1.90971C315.458 2.62959 301.298 2.97954 300.158 3.50946H300.168ZM221.308 4.29934L223.978 4.60929L239.138 3.03953C249.108 3.39948 260.778 3.96939 267.888 4.85925H240.518C240.788 4.67928 241.038 4.47931 241.418 4.30934C232.378 4.17936 233.278 4.48931 233.978 4.85925H219.398C218.828 4.64928 218.918 4.42932 221.318 4.29934H221.308ZM184.198 3.61944C186.278 4.19935 178.448 3.94939 174.648 4.16936C187.258 5.30918 186.888 3.92939 194.508 3.49946C205.008 3.64944 217.198 3.99938 217.388 4.85925H115.198C115.498 4.5693 116.078 4.30934 117.598 4.16936L103.458 4.50931C121.638 2.29965 156.098 4.99923 184.198 3.61944ZM18.6284 8.89863C22.3884 6.469 26.7984 4.93924 30.6484 4.47931C34.5384 4.05937 37.6284 4.35933 39.3584 4.67928L34.5584 3.77942C61.9384 4.31933 84.6984 2.30964 112.448 1.87971C104.238 2.34964 102.508 3.83941 91.2884 3.81941C98.4684 4.04938 99.8484 4.41932 99.6984 4.84925H34.5584C20.8784 4.84925 9.3584 13.7479 5.8684 25.866C6.0784 24.4162 6.2584 23.4564 5.9884 23.6764C6.8584 22.2066 7.9184 19.9569 9.6684 17.5073C11.7384 14.5078 14.8284 11.2883 18.6284 8.88863V8.89863ZM4.7784 72.1189C4.7584 68.7194 4.7284 65.6599 4.6484 63.2103L4.7784 63.4602V72.1189ZM4.7784 86.2567V118.412C3.9084 114.422 3.0284 112.533 3.4784 99.7646C4.5484 107.853 4.3384 90.5361 4.7784 86.2567ZM4.7784 138.139V150.887C4.5484 149.167 4.3184 147.247 4.1384 144.728C4.2684 140.938 4.5084 139.189 4.7784 138.139ZM3.3984 42.8834C3.7184 43.5133 4.3484 47.9426 4.7784 49.4224V61.8505C4.2284 55.8114 3.1184 52.6219 3.3984 42.8834ZM28.2784 253.881C27.7184 253.821 27.0984 253.731 26.4284 253.621C26.0884 253.561 25.7384 253.501 25.3684 253.441C25.0084 253.341 24.6384 253.231 24.2584 253.131C21.1884 252.311 17.5084 250.581 14.2284 247.932C10.9284 245.302 8.0784 241.783 6.1684 238.093C4.2184 234.404 3.2484 230.614 2.7184 227.575C2.7184 225.215 2.9084 223.066 2.9984 220.776C3.0984 218.496 3.1584 216.147 3.1984 213.757C3.2684 208.968 3.2284 203.979 3.1284 198.929C2.9384 188.831 2.5284 178.492 2.3984 168.984C3.3084 168.444 4.1184 174.503 4.7884 176.033V184.822C4.7884 184.822 4.7884 184.732 4.7884 184.692C4.6984 188.541 4.7084 191.96 4.7884 195.09V206.728C4.7284 212.747 4.6584 218.596 4.7084 224.135C4.7084 225.385 4.7884 226.625 4.9384 227.825C5.5984 234.464 8.6184 240.433 13.1584 244.972C13.1084 244.932 13.0584 244.892 13.0084 244.842C13.0984 244.922 13.1784 245.002 13.2584 245.072C15.2284 247.022 17.4884 248.702 19.9684 250.051C20.0784 250.131 20.1884 250.211 20.2884 250.281C20.5384 250.441 20.7884 250.591 21.0284 250.741C21.5184 251.041 21.9884 251.331 22.5084 251.651C23.0284 251.971 23.6484 252.191 24.3684 252.481C24.7284 252.621 25.1184 252.761 25.5484 252.911C25.9884 253.021 26.4684 253.131 26.9984 253.241C27.5284 253.341 28.0884 253.491 28.7284 253.551C29.3684 253.601 30.0484 253.651 30.8084 253.701C30.2784 253.841 29.4084 253.911 28.2784 253.861V253.881ZM75.6784 253.751H79.9284C78.5684 253.771 77.1484 253.771 75.6784 253.751ZM155.388 255.651C153.548 254.701 152.398 254.251 152.388 253.751H181.898C172.458 254.371 163.288 255.011 155.388 255.651ZM339.668 254.311C343.518 254.201 345.728 254.001 346.898 253.741H359.528C353.928 253.951 346.598 254.631 339.668 254.311ZM364.538 253.741H381.688C379.168 254.091 375.028 254.371 368.068 254.521C367.318 254.071 366.098 253.841 364.538 253.741ZM483.028 257.53L484.518 256.58C466.808 256.74 461.588 256.77 446.248 257.27C417.878 255.511 471.168 256.99 463.358 254.711L455.248 255.091C457.168 254.721 459.208 254.241 461.578 253.751H535.908C536.388 253.981 537.658 254.181 540.518 254.311C510.218 253.041 504.238 256.76 483.008 257.53H483.028ZM679.338 253.741H680.958C680.768 253.771 680.568 253.791 680.388 253.821C680.008 253.791 679.658 253.771 679.328 253.741H679.338ZM730.198 254.791C728.478 253.771 745.588 254.301 741.258 254.061L738.068 253.991C738.358 253.901 738.708 253.821 739.078 253.741H760.338C755.168 254.491 744.318 254.871 730.208 254.791H730.198Z"
                  fill="#191919"
                />
              </svg>
            </div>
          </div>

          <div className="flex justify-center sm:justify-end mt-8">
            <Button 
              buttonImage={OrangeBackground} 
              altText="send" 
              text="Send Message" 
              onClick={(e) => handleSubmit(e)} 
              loading={loading} 
            />
          </div>
        </form>
      </div>

      <Image src={SignMark} alt="sign" className="hidden xl:block absolute bottom-0 left-2/6 w-64 -translate-x-2/6" />
      <Image src={CloudBottom} alt="cloud" className="absolute bottom-0 left-0 w-64" />
    </Herobox>
  );
};

export default ContactForm;
